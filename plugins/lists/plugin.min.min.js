tinymce.PluginManager.add("lists",function(x){function C(a){return x.$.contains(x.getBody(),a)}function j(a){return a&&"BR"==a.nodeName}function b(a){return a&&/^(OL|UL|DL)$/.test(a.nodeName)&&C(a)}function v(a){return a&&/^(LI|DT|DD)$/.test(a.nodeName)}function h(a){return a.parentNode.firstChild==a}function A(a){return a.parentNode.lastChild==a}function D(a){return a&&!!x.schema.getTextBlockElements()[a.nodeName]}function q(a){return a===x.getBody()}function z(a){return a&&3===a.nodeType}function B(d,a){var f=tinymce.dom.RangeUtils.getNode(d,a);if(v(d)&&z(f)){var c=a>=d.childNodes.length?f.data.length:0;return{container:f,offset:c}}return{container:d,offset:a}}function y(d){var a=d.cloneRange(),f=B(d.startContainer,d.startOffset);a.setStart(f.container,f.offset);var c=B(d.endContainer,d.endOffset);return a.setEnd(c.container,c.offset),a}var w=this;x.on("init",function(){function Z(m,c){var p=J.isEmpty(m);return !(c&&J.select("span[data-mce-type=bookmark]").length>0)&&p}function G(m){function c(E){var I,u,L;u=m[E?"startContainer":"endContainer"],L=m[E?"startOffset":"endOffset"],1==u.nodeType&&(I=J.create("span",{"data-mce-type":"bookmark"}),u.hasChildNodes()?(L=Math.min(L,u.childNodes.length-1),E?u.insertBefore(I,u.childNodes[L]):J.insertAfter(I,u.childNodes[L])):u.appendChild(I),u=I,L=0),p[E?"startContainer":"endContainer"]=u,p[E?"startOffset":"endOffset"]=L}var p={};return c(!0),m.collapsed||c(),p}function U(m){function c(E){function M(P){for(var N=P.parentNode.firstChild,R=0;N;){if(N==P){return R}1==N.nodeType&&"bookmark"==N.getAttribute("data-mce-type")||R++,N=N.nextSibling}return -1}var I,u,L;I=L=m[E?"startContainer":"endContainer"],u=m[E?"startOffset":"endOffset"],I&&(1==I.nodeType&&(u=M(I),I=I.parentNode,J.remove(L)),m[E?"startContainer":"endContainer"]=I,m[E?"startOffset":"endOffset"]=u)}c(!0),c();var p=J.createRng();p.setStart(m.startContainer,m.startOffset),m.endContainer&&p.setEnd(m.endContainer,m.endOffset),l.setRng(y(p))}function V(u,M){var I,p,L,m=J.createFragment(),E=x.schema.getBlockElements();if(x.settings.forced_root_block&&(M=M||x.settings.forced_root_block),M&&(p=J.create(M),p.tagName===x.settings.forced_root_block&&J.setAttribs(p,x.settings.forced_root_block_attrs),m.appendChild(p)),u){for(;I=u.firstChild;){var c=I.nodeName;L||"SPAN"==c&&"bookmark"==I.getAttribute("data-mce-type")||(L=!0),E[c]?(m.appendChild(I),p=null):M?(p||(p=J.create(M),m.appendChild(p)),p.appendChild(I)):m.appendChild(I)}}return x.settings.forced_root_block?L||tinymce.Env.ie&&!(tinymce.Env.ie>10)||p.appendChild(J.create("br",{"data-mce-bogus":"1"})):m.appendChild(J.create("br")),m}function Y(){return tinymce.grep(l.getSelectedBlocks(),function(c){return v(c)})}function X(I,p,M){function E(N){tinymce.each(c,function(P){N.parentNode.insertBefore(P,p.parentNode)}),J.remove(N)}var m,L,c,u;for(c=J.select('span[data-mce-type="bookmark"]',I),M=M||V(p),m=J.createRng(),m.setStartAfter(p),m.setEndAfter(I),L=m.extractContents(),u=L.firstChild;u;u=u.firstChild){if("LI"==u.nodeName&&J.isEmpty(u)){J.remove(u);break}}J.isEmpty(L)||J.insertAfter(L,I),J.insertAfter(M,I),Z(p.parentNode)&&E(p.parentNode),J.remove(p),Z(I)&&J.remove(I)}function F(m){var c,p;if(c=m.nextSibling,c&&b(c)&&c.nodeName==m.nodeName&&n(m,c)){for(;p=c.firstChild;){m.appendChild(p)}J.remove(c)}if(c=m.previousSibling,c&&b(c)&&c.nodeName==m.nodeName&&n(m,c)){for(;p=c.lastChild;){m.insertBefore(p,m.firstChild)}J.remove(c)}}function aa(c){tinymce.each(tinymce.grep(J.select("ol,ul",c)),o)}function o(m){var c,p=m.parentNode;"LI"==p.nodeName&&p.firstChild==m&&(c=p.previousSibling,c&&"LI"==c.nodeName?(c.appendChild(m),Z(p)&&J.remove(p)):J.setStyle(p,"listStyleType","none")),b(p)&&(c=p.previousSibling,c&&"LI"==c.nodeName&&c.appendChild(m))}function s(u){function m(I){Z(I)&&J.remove(I)}var E,c=u.parentNode,p=c.parentNode;return !!q(c)||("DD"==u.nodeName?(J.rename(u,"DT"),!0):h(u)&&A(u)?("LI"==p.nodeName?(J.insertAfter(u,p),m(p),J.remove(c)):b(p)?J.remove(c,!0):(p.insertBefore(V(u),c),J.remove(c)),!0):h(u)?("LI"==p.nodeName?(J.insertAfter(u,p),u.appendChild(c),m(p)):b(p)?p.insertBefore(u,c):(p.insertBefore(V(u),c),J.remove(u)),!0):A(u)?("LI"==p.nodeName?J.insertAfter(u,p):b(p)?J.insertAfter(u,c):(J.insertAfter(V(u),c),J.remove(u)),!0):("LI"==p.nodeName?(c=p,E=V(u,"LI")):E=b(p)?V(u,"LI"):V(u),X(c,u,E),aa(c.parentNode),!0))}function K(p){function m(L,M){var I;if(b(L)){for(;I=p.lastChild.firstChild;){M.appendChild(I)}J.remove(L)}}var E,c,u;return"DT"==p.nodeName?(J.rename(p,"DD"),!0):(E=p.previousSibling,E&&b(E)?(E.appendChild(p),!0):E&&"LI"==E.nodeName&&b(E.lastChild)?(E.lastChild.appendChild(p),m(p.lastChild,E.lastChild),!0):(E=p.nextSibling,E&&b(E)?(E.insertBefore(p,E.firstChild),!0):(E=p.previousSibling,!(!E||"LI"!=E.nodeName)&&(c=J.create(p.parentNode.nodeName),u=J.getStyle(p.parentNode,"listStyleType"),u&&J.setStyle(c,"listStyleType",u),E.appendChild(c),c.appendChild(p),m(p.lastChild,c),!0))))}function t(){var c=Y();if(c.length){for(var p=G(l.getRng(!0)),m=0;m<c.length&&(K(c[m])||0!==m);m++){}return U(p),x.nodeChanged(),!0}}function i(){var p=Y();if(p.length){var I,u,m=G(l.getRng(!0)),E=x.getBody();for(I=p.length;I--;){for(var c=p[I].parentNode;c&&c!=E;){for(u=p.length;u--;){if(p[u]===c){p.splice(I,1);break}}c=c.parentNode}}for(I=0;I<p.length&&(s(p[I])||0!==I);I++){}return U(m),x.nodeChanged(),!0}}function W(E,u){function I(){function R(ae){var c,af;for(c=m[ae?"startContainer":"endContainer"],af=m[ae?"startOffset":"endOffset"],1==c.nodeType&&(c=c.childNodes[Math.min(af,c.childNodes.length-1)]||c);c.parentNode!=ac;){if(D(c)){return c}if(/^(TD|TH)$/.test(c.parentNode.nodeName)){return c}c=c.parentNode}return c}for(var S,P=[],ac=x.getBody(),M=R(!0),ad=R(),N=[],T=M;T&&(N.push(T),T!=ad);T=T.nextSibling){}return tinymce.each(N,function(ae){if(D(ae)){return P.push(ae),void (S=null)}if(J.isBlock(ae)||j(ae)){return j(ae)&&J.remove(ae),void (S=null)}var c=ae.nextSibling;return tinymce.dom.BookmarkManager.isBookmarkNode(ae)&&(D(c)||!c&&ae.parentNode==ac)?void (S=null):(S||(S=J.create("p"),ae.parentNode.insertBefore(S,ae),P.push(S)),void S.appendChild(ae))}),P}var p,m=l.getRng(!0),L="LI";"false"!==J.getContentEditable(l.getNode())&&(E=E.toUpperCase(),"DL"==E&&(L="DT"),p=G(m),tinymce.each(I(),function(M){var P,N,c=function(S){var R=J.getStyle(S,"list-style-type"),T=u?u["list-style-type"]:"";return T=null===T?"":T,R===T};N=M.previousSibling,N&&b(N)&&N.nodeName==E&&c(N)?(P=N,M=J.rename(M,L),N.appendChild(M)):(P=J.create(E),M.parentNode.insertBefore(P,M),P.appendChild(M),M=J.rename(M,L)),r(P,u),F(P)}),U(p))}function d(){var m=G(l.getRng(!0)),u=x.getBody(),c=Y(),p=tinymce.util.Tools.grep(c,function(E){return Z(E)});c=tinymce.util.Tools.grep(c,function(E){return !Z(E)}),tinymce.each(p,function(E){if(Z(E)){return void s(E)}}),tinymce.each(c,function(L){var I,E;if(!q(L.parentNode)){for(I=L;I&&I!=u;I=I.parentNode){b(I)&&(E=I)}X(E,L),aa(E.parentNode)}}),U(m)}function ab(p,c){var u=J.getParent(l.getStart(),"OL,UL,DL");if(!q(u)){if(u){if(u.nodeName==p){d(p)}else{var m=G(l.getRng(!0));r(u,c),F(J.rename(u,p)),U(m)}}else{W(p,c)}}}function H(c){return function(){var m=J.getParent(x.selection.getStart(),"UL,OL,DL");return m&&m.nodeName==c}}function a(c){return !!j(c)&&!(!J.isBlock(c.nextSibling)||j(c.previousSibling))}function e(p,I){var u,m,E=p.startContainer,c=p.startOffset;if(3==E.nodeType&&(I?c<E.data.length:c>0)){return E}for(u=x.schema.getNonEmptyElements(),1==E.nodeType&&(E=tinymce.dom.RangeUtils.getNode(E,c)),m=new tinymce.dom.TreeWalker(E,x.getBody()),I&&a(E)&&m.next();E=m[I?"next":"prev2"]();){if("LI"==E.nodeName&&!E.hasChildNodes()){return E}if(u[E.nodeName]){return E}if(3==E.nodeType&&E.data.length>0){return E}}}function Q(u,m){var E,c,p=u.parentNode;if(C(u)&&C(m)){if(b(m.lastChild)&&(c=m.lastChild),p==m.lastChild&&j(p.previousSibling)&&J.remove(p.previousSibling),E=m.lastChild,E&&j(E)&&u.hasChildNodes()&&J.remove(E),Z(m,!0)&&J.$(m).empty(),!Z(u,!0)){for(;E=u.firstChild;){m.appendChild(E)}}c&&m.appendChild(c),J.remove(u),Z(p)&&!q(p)&&J.remove(p)}}function O(u){var m,I,p,c=J.getParent(l.getStart(),"LI");if(c){if(m=c.parentNode,q(m)&&J.isEmpty(m)){return !0}if(I=y(l.getRng(!0)),p=J.getParent(e(I,u),"LI"),p&&p!=c){var E=G(I);return u?Q(p,c):Q(c,p),U(E),!0}if(!p&&!u&&d(m.nodeName)){return !0}}}function f(){var c=x.dom.getParent(x.selection.getStart(),"LI,DT,DD");return !!(c||Y().length>0)&&(x.undoManager.transact(function(){x.execCommand("Delete"),aa(x.getBody())}),!0)}var J=x.dom,l=x.selection,n=function(m,u){var p=x.dom.getStyle(m,"list-style-type",!0),c=x.dom.getStyle(u,"list-style-type",!0);return p===c},r=function(m,c){J.setStyle(m,"list-style-type",c?c["list-style-type"]:null)};w.backspaceDelete=function(c){return l.isCollapsed()?O(c):f()},x.on("BeforeExecCommand",function(c){var p,m=c.command.toLowerCase();if("indent"==m?t()&&(p=!0):"outdent"==m&&i()&&(p=!0),p){return x.fire("ExecCommand",{command:c.command}),c.preventDefault(),!0}}),x.addCommand("InsertUnorderedList",function(m,c){ab("UL",c)}),x.addCommand("InsertOrderedList",function(m,c){ab("OL",c)}),x.addCommand("InsertDefinitionList",function(m,c){ab("DL",c)}),x.addQueryStateHandler("InsertUnorderedList",H("UL")),x.addQueryStateHandler("InsertOrderedList",H("OL")),x.addQueryStateHandler("InsertDefinitionList",H("DL")),x.on("keydown",function(c){9!=c.keyCode||tinymce.util.VK.metaKeyPressed(c)||x.dom.getParent(x.selection.getStart(),"LI,DT,DD")&&(c.preventDefault(),c.shiftKey?i():t())})});var g=function(a){return function(){var c=this;x.on("NodeChange",function(f){var d=tinymce.util.Tools.grep(f.parents,b);c.active(d.length>0&&d[0].nodeName===a)})}},k=function(c,a){var d=c.settings.plugins?c.settings.plugins:"";return tinymce.util.Tools.inArray(d.split(/[ ,]/),a)!==-1};k(x,"advlist")||(x.addButton("numlist",{title:"Numbered list",cmd:"InsertOrderedList",onPostRender:g("OL")}),x.addButton("bullist",{title:"Bullet list",cmd:"InsertUnorderedList",onPostRender:g("UL")})),x.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var a=this;x.on("nodechange",function(){for(var l=x.selection.getSelectedBlocks(),f=!1,d=0,c=l.length;!f&&d<c;d++){var e=l[d].nodeName;f="LI"==e&&h(l[d])||"UL"==e||"OL"==e||"DD"==e}a.disabled(f)})}}),x.on("keydown",function(a){a.keyCode==tinymce.util.VK.BACKSPACE?w.backspaceDelete()&&a.preventDefault():a.keyCode==tinymce.util.VK.DELETE&&w.backspaceDelete(!0)&&a.preventDefault()})});