tinymce.PluginManager.add("importcss",function(v){function A(c){var a=tinymce.Env.cacheSuffix;return"string"==typeof c&&(c=c.replace("?"+a,"").replace("&"+a,"")),c}function j(c){var e=v.settings,d=e.skin!==!1&&(e.skin||"lightgray");if(d){var a=e.skin_url;return a=a?v.documentBaseURI.toAbsolute(a):tinymce.baseURL+"/skins/"+d,c===a+"/content"+(v.inline?".inline":"")+".min.css"}return !1}function b(a){return"string"==typeof a?function(c){return c.indexOf(a)!==-1}:a instanceof RegExp?function(c){return a.test(c)}:a}function m(l,d){function p(t,o){var i,a=t.href;if(a=A(a),a&&d(a,o)&&!j(a)){g(t.imports,function(r){p(r,!0)});try{i=t.cssRules||t.rules}catch(t){}g(i,function(r){r.styleSheet?p(r.styleSheet,!0):r.selectorText&&g(r.selectorText.split(","),function(s){c.push(tinymce.trim(s))})})}}var c=[],f={};g(n.contentCSS,function(a){f[a]=!0}),d||(d=function(i,a){return a||f[i]});try{g(l.styleSheets,function(a){p(a)})}catch(n){}return c}function h(e){var p,f=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(f){var d=f[1],l=f[2].substr(1).split(".").join(" "),c=tinymce.makeMap("a,img");return f[1]?(p={title:e},v.schema.getTextBlockElements()[d]?p.block=d:v.schema.getBlockElements()[d]||c[d.toLowerCase()]?p.selector=d:p.inline=d):f[2]&&(p={inline:"span",title:e.substr(1),classes:l}),v.settings.importcss_merge_classes!==!1?p.classes=l:p.attributes={"class":l},p}}function y(c,a){return tinymce.util.Tools.grep(c,function(d){return !d.filter||d.filter(a)})}function B(a){return tinymce.util.Tools.map(a,function(c){return tinymce.util.Tools.extend({},c,{original:c,selectors:{},filter:b(c.filter),item:{text:c.title,menu:[]}})})}function k(c,a){return null===a||c.settings.importcss_exclusive!==!1}function x(a,d,c){return !(k(v,d)?a in c:a in d.selectors)}function z(a,d,c){k(v,d)?c[a]=!0:d.selectors[a]=!0}function w(e,l,f){var d,c=v.settings;return d=f&&f.selector_converter?f.selector_converter:c.importcss_selector_converter?c.importcss_selector_converter:h,d.call(e,l,f)}var q=this,g=tinymce.each;v.on("renderFormatsMenu",function(d){var p=v.settings,i={},c=b(p.importcss_selector_filter),a=d.control,f=B(p.importcss_groups),e=function(o,u){if(x(o,u,i)){z(o,u,i);var s=w(q,o,u);if(s){var l=s.name||tinymce.DOM.uniqueId();return v.formatter.register(l,s),tinymce.extend({},a.settings.itemDefaults,{text:s.title,format:l})}}return null};v.settings.importcss_append||a.items().remove(),g(m(d.doc||v.getDoc(),b(p.importcss_file_filter)),function(o){if(o.indexOf(".mce-")===-1&&(!c||c(o))){var l=y(f,o);if(l.length>0){tinymce.util.Tools.each(l,function(s){var u=e(o,s);u&&s.item.menu.push(u)})}else{var r=e(o,null);r&&a.add(r)}}}),g(f,function(l){l.item.menu.length>0&&a.add(l.item)}),d.control.renderNew()}),q.convertSelectorToFormat=h});